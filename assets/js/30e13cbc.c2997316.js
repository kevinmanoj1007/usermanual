"use strict";(self.webpackChunkuser_manual=self.webpackChunkuser_manual||[]).push([[4919],{8357:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>i,metadata:()=>c,toc:()=>a});const c=JSON.parse('{"id":"cdk/baseconnector","title":"BaseConnector","description":"The BaseConnector class is an abstract base class for building WebSocket-based connectors. It defines the lifecycle, connection handling, callback management, task orchestration, and communication protocols between the client and the backend system.","source":"@site/connectors/cdk/baseconnector.md","sourceDirName":"cdk","slug":"/cdk/baseconnector","permalink":"/connectors/cdk/baseconnector","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"connectorsSidebar","previous":{"title":"Introduction","permalink":"/connectors/intro"},"next":{"title":"BaseDomain","permalink":"/connectors/cdk/basedomain"}}');var r=s(4848),t=s(8453);const i={},l="BaseConnector",d={},a=[{value:"Class Definition",id:"class-definition",level:2},{value:"Constructor",id:"constructor",level:2},{value:"Parameters",id:"parameters",level:3},{value:"Initializes",id:"initializes",level:3},{value:"Attributes",id:"attributes",level:2},{value:"Public Methods",id:"public-methods",level:2},{value:"Internal Methods",id:"internal-methods",level:2},{value:"Required Subclass Implementation",id:"required-subclass-implementation",level:2},{value:"Lifecycle Callbacks",id:"lifecycle-callbacks",level:2},{value:"Dependencies",id:"dependencies",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"baseconnector",children:"BaseConnector"})}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.a,{href:"baseconnector",children:"BaseConnector"})," class is an abstract base class for building WebSocket-based connectors. It defines the lifecycle, connection handling, callback management, task orchestration, and communication protocols between the client and the backend system."]}),"\n",(0,r.jsx)(n.h2,{id:"class-definition",children:"Class Definition"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"class BaseConnector(ABC): pass\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Inherits from:"})," ABC (Abstract Base Class)"]}),"\n",(0,r.jsx)(n.h2,{id:"constructor",children:"Constructor"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"def __init__(\r\n    *,\r\n    logger,\r\n    secret: str,\r\n    options: dict,\r\n    throw_errors=False,\r\n    startup: BaseStartup,\r\n    hb_timeout: int = 20,\r\n    connection: AsyncInterface,\r\n) -> None\n"})}),"\n",(0,r.jsx)(n.h3,{id:"parameters",children:"Parameters"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"logger"}),": Logging utility used for reporting connector status and errors."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"secret"})," (str): Client-specific secret key for authentication."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"options"})," (dict): Runtime configuration options."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"throw_errors"})," (bool): If True, exceptions will be re-raised. Defaults to False."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"startup"})," (",(0,r.jsx)(n.a,{href:"basestartup",children:"BaseStartup"}),"): Component defining startup logic to be executed before connection."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"hb_timeout"})," (int): Heartbeat interval in seconds. Defaults to 20."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"connection"})," (AsyncInterface): Asynchronous WebSocket client interface."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"initializes",children:"Initializes"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Callback registry"}),"\n",(0,r.jsx)(n.li,{children:"WebSocket and connection pool"}),"\n",(0,r.jsx)(n.li,{children:"Thread pool for background execution"}),"\n",(0,r.jsx)(n.li,{children:"Heartbeat timeout and internal task list"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"attributes",children:"Attributes"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Attribute"}),(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"_logger"})}),(0,r.jsx)(n.td,{children:"Logger"}),(0,r.jsx)(n.td,{children:"Logging utility"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"_ws"})}),(0,r.jsx)(n.td,{children:"AsyncInterface"}),(0,r.jsx)(n.td,{children:"WebSocket connection handler"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"_secret"})}),(0,r.jsx)(n.td,{children:"str"}),(0,r.jsx)(n.td,{children:"Client key for authorization"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"startup"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.a,{href:"basestartup",children:"BaseStartup"})}),(0,r.jsx)(n.td,{children:"Startup routine handler"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"_options"})}),(0,r.jsx)(n.td,{children:"dict"}),(0,r.jsx)(n.td,{children:"Runtime feature flags"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"_hb_timeout"})}),(0,r.jsx)(n.td,{children:"int"}),(0,r.jsx)(n.td,{children:"Heartbeat interval"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"_throw_errors"})}),(0,r.jsx)(n.td,{children:"bool"}),(0,r.jsx)(n.td,{children:"Flag for error propagation"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"_headers"})}),(0,r.jsx)(n.td,{children:"dict"}),(0,r.jsx)(n.td,{children:"HTTP headers for connection"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"callbacks"})}),(0,r.jsx)(n.td,{children:"dict[Callbacks, Callable | None]"}),(0,r.jsx)(n.td,{children:"Registered lifecycle callbacks"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"thread_pool"})}),(0,r.jsx)(n.td,{children:"ThreadPoolExecutor"}),(0,r.jsx)(n.td,{children:"Thread pool for blocking or CPU-bound tasks"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"connection_pool"})}),(0,r.jsx)(n.td,{children:"WebsocketPool"}),(0,r.jsx)(n.td,{children:"Pool of WebSocket client connections"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"public-methods",children:"Public Methods"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"def start(self)\n"})}),"\n",(0,r.jsx)(n.p,{children:"Executes the startup routine, triggers the ON_STARTUP callback, and begins the connector's event loop using asyncio.run."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"def register_callback(self, kind: Callbacks, cb: Callable)\n"})}),"\n",(0,r.jsx)(n.p,{children:"Registers a user-defined callback function for a given lifecycle event type (Callbacks)."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"@abstractmethod\r\nasync def receiver(self)\n"})}),"\n",(0,r.jsx)(n.p,{children:"Subclasses must implement this method. It should define how the connector receives and processes incoming messages."}),"\n",(0,r.jsx)(n.h2,{id:"internal-methods",children:"Internal Methods"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"async def _start(self)\n"})}),"\n",(0,r.jsx)(n.p,{children:"Establishes WebSocket connection and begins processing loop:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Starts receiver and _heartbeat tasks."}),"\n",(0,r.jsx)(n.li,{children:"Restarts on failure, unless cancelled."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Handles:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Heartbeats"}),"\n",(0,r.jsx)(n.li,{children:"Task cancellation"}),"\n",(0,r.jsx)(n.li,{children:"Reconnection on ConnectionClosed"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"def _add_task(self, handle, name)\n"})}),"\n",(0,r.jsx)(n.p,{children:"Creates and tracks an asynchronous task."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"def _cleanup_tasks(self)\n"})}),"\n",(0,r.jsx)(n.p,{children:"Cancels all tracked async tasks."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"def call_cb(self, id: Callbacks)\n"})}),"\n",(0,r.jsx)(n.p,{children:"Invokes the callback associated with the provided event type, if defined."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"async def restart_connections(self, error: Exception)\n"})}),"\n",(0,r.jsx)(n.p,{children:"Handles unexpected connection closures. If throw_errors is enabled, re-raises the exception. Otherwise:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Logs the error"}),"\n",(0,r.jsx)(n.li,{children:"Waits briefly"}),"\n",(0,r.jsx)(n.li,{children:"Re-establishes WebSocket and connection pool"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"async def cleanup()\n"})}),"\n",(0,r.jsx)(n.p,{children:"Cleans up all active tasks, closes WebSocket and connection pool."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"async def _heartbeat()\n"})}),"\n",(0,r.jsx)(n.p,{children:"Sends a periodic heartbeat message to maintain the connection."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"async def send_message(self, request, request_id, body)\n"})}),"\n",(0,r.jsx)(n.p,{children:"Sends a structured success response over the WebSocket."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Message structure:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\r\n  "status": "success",\r\n  "request": "<request>",\r\n  "request_id": "<request_id>",\r\n  "body": { ... }\r\n}\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"async def send_error(self, request, request_id, code, message)\n"})}),"\n",(0,r.jsx)(n.p,{children:"Sends a structured error message over the WebSocket."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Message structure:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\r\n  "status": "error",\r\n  "request": "<request>",\r\n  "request_id": "<request_id>",\r\n  "code": <status_code>,\r\n  "message": "<description>"\r\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"required-subclass-implementation",children:"Required Subclass Implementation"}),"\n",(0,r.jsxs)(n.p,{children:["Any subclass of ",(0,r.jsx)(n.a,{href:"baseconnector",children:"BaseConnector"})," must implement:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"async def receiver(self):\r\n    ...\n"})}),"\n",(0,r.jsx)(n.p,{children:"This method is responsible for consuming and acting upon incoming messages from the WebSocket stream."}),"\n",(0,r.jsx)(n.h2,{id:"lifecycle-callbacks",children:"Lifecycle Callbacks"}),"\n",(0,r.jsx)(n.p,{children:"Callbacks can be registered and invoked at key lifecycle stages using the Callbacks enum:"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Callback Type"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"ON_STARTUP"}),(0,r.jsx)(n.td,{children:"After startup routine is executed"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"ON_CONNECT"}),(0,r.jsx)(n.td,{children:"Upon successful WebSocket connection"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"ON_STOP"}),(0,r.jsx)(n.td,{children:"When the connector is gracefully stopped"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"dependencies",children:"Dependencies"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["cdk.base_domain.",(0,r.jsx)(n.a,{href:"basedomain",children:"BaseDomain"})]}),"\n",(0,r.jsx)(n.li,{children:"cdk.connection_pool.WebsocketPool"}),"\n",(0,r.jsxs)(n.li,{children:["cdk.services.startup.",(0,r.jsx)(n.a,{href:"basestartup",children:"BaseStartup"})]}),"\n",(0,r.jsx)(n.li,{children:"cdk.constants.Callbacks"}),"\n",(0,r.jsx)(n.li,{children:"core.websocket.asyncio.interface.AsyncInterface"}),"\n",(0,r.jsx)(n.li,{children:"cdk.config.cdk_settings"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>l});var c=s(6540);const r={},t=c.createContext(r);function i(e){const n=c.useContext(t);return c.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),c.createElement(t.Provider,{value:n},e.children)}}}]);